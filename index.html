<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Absensi LAB</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <style>
        /* --- CSS: BIAR TAMPILAN KAYAK APP (User Interface) --- */
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #121212; /* Dark Mode */
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .app-container {
            width: 100%;
            max-width: 400px; /* Ukuran HP */
            background-color: #1e1e1e;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        h2 { text-align: center; color: #bb86fc; margin-bottom: 20px; }
        
        /* Input Form Styling */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-size: 0.9em; color: #aaa; }
        input, select {
            width: 100%;
            padding: 12px;
            background: #2c2c2c;
            border: 1px solid #333;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            box-sizing: border-box; /* Biar padding ga ngerusak lebar */
        }
        
        /* Tombol Utama */
        .btn-scan {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #bb86fc, #3700b3);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
        .btn-scan:active { transform: scale(0.98); }

        /* Area Kamera (Hidden dulu sebelum dipanggil) */
        #reader { width: 100%; margin-top: 20px; border-radius: 10px; overflow: hidden; }
        
        /* Status Loading/Sukses */
        #status-msg { text-align: center; margin-top: 15px; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="app-container">
    <h2>Absensi Lab</h2>

    <div class="form-group">
        <label>Nama Lengkap</label>
        <input type="text" id="nama" placeholder="Contoh: Gibran Cahaya Asia">
    </div>

    <div class="form-group">
        <label>Status</label>
        <select id="status">
            <option value="Masuk">üü¢ Masuk Shift</option>
            <option value="Pulang">üî¥ Pulang Shift</option>
        </select>
    </div>

    <div class="form-group">
        <label>Shift Ke-</label>
        <select id="shift">
            <option value="1">Shift 1 (Pagi)</option>
            <option value="2">Shift 2 (Siang)</option>
            <option value="3">Lembur / Ganti</option>
        </select>
    </div>

    <div class="form-group">
        <label>Waktu Absen (Jam Saat Ini)</label>
        <input type="text" id="waktu" readonly style="background: #333; color: #888;">
    </div>

    <button class="btn-scan" onclick="mulaiScan()">üì∑ Scan QR & Kirim</button>

    <div id="reader"></div>
    <div id="status-msg"></div>
</div>

<script>
    // --- MATERI: PRE-PROCESSING DATA ---
    // Otomatis isi jam saat ini biar user ga repot (User Experience)
    function updateJam() {
        const now = new Date();
        // Format HH:MM
        const jamStr = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
        document.getElementById('waktu').value = jamStr;
    }
    setInterval(updateJam, 1000); // Update tiap detik
    updateJam();

    // --- FUNGSI UTAMA: SCAN QR ---
    function mulaiScan() {
        // Validasi Input dulu (Error Handling Sederhana)
        const nama = document.getElementById('nama').value;
        if (!nama) {
            alert("Isi nama dulu lahhhh!");
            return;
        }

        const html5QrCode = new Html5Qrcode("reader");
        document.getElementById('status-msg').innerText = "Arahkan kamera ke QR Code di tembok...";

        // Config kamera
        const config = { fps: 10, qrbox: { width: 250, height: 250 } };
        
        // Start Kamera
        html5QrCode.start({ facingMode: "environment" }, config, onScanSuccess);
    }

    // --- MATERI: CALLBACK FUNCTION ---
    // Fungsi ini cuma jalan KALO QR berhasil kebaca
    function onScanSuccess(decodedText, decodedResult) {
        // 1. Stop Kamera biar hemat batre
        // html5QrCode.stop(); (Harusnya distop, tapi kita perlu handle object-nya dulu, anggap stop manual by refresh or logic)
        // Kita reload halaman setelah sukses nanti.

        document.getElementById('status-msg').innerText = "QR Terbaca! Mengirim data...";
        
        // decodedText = URL SCRIPT GOOGLE SHEET lu yang ada di QR Code
        // Inilah "Key" nya.
        kirimData(decodedText);
    }

    // --- MATERI: HTTP REQUEST & ASYNCHRONOUS (AJAX/FETCH) ---
    function kirimData(urlScript) {
        
        // 1. DATA BINDING (Mengikat data form ke variabel)
        const namaUser = document.getElementById('nama').value;
        const statusUser = document.getElementById('status').value;
        const shiftUser = document.getElementById('shift').value;
        const waktuUser = document.getElementById('waktu').value;

        // 2. OBJECT CREATION (Struktur Data Inti)
        // Kita bungkus semua data jadi satu Object JS
        const dataAbsen = {
            nama: namaUser,
            status: statusUser,
            shift: shiftUser,
            waktu: waktuUser
        };

        // 3. SENDING DATA (POST Request)
        // fetch() adalah cara modern kirim data di JS
        fetch(urlScript, {
            method: "POST",
            // mode: "no-cors" PENTING buat Google Script biar ga kena blokir browser
            mode: "no-cors", 
            headers: {
                "Content-Type": "application/json"
            },
            // Konversi Object -> String JSON
            body: JSON.stringify(dataAbsen)
        })
        .then(() => {
            // Feedback ke User
            alert("‚úÖ Absen Berhasil Masuk, Bre! Selamat bekerja/istirahat.");
            window.location.reload(); // Refresh halaman
        })
        .catch(error => {
            alert("‚ùå Gagal kirim: " + error);
        });
    }
</script>

</body>
</html>